jobs:
  include:
    - stage: test
      language: python
      python:
        - "3.7"
      install:
        - pip install -r travis-requirements.txt
      script:
        - cd src/classscribe
        - python manage.py makemigrations
        - python manage.py migrate
        - python manage.py test
    - stage: test
      language: node_js
      node_js:
        - 'stable'
      addons:
        apt:
          packages:
            - libgconf-2-4
      cache:
        npm: true
        directories:
          - ~/.cache
      before_install:
        - cd src/classscribe-fe
        - npm start -- --silent &
      install:
        - npm install ci
      script:
        - npm install react-dom 
        - npm run start:ci &
        - npm run test
        - cypress run --record
        - kill $(jobs -p) || true